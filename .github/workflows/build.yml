name: Build macOS Application

on:
  push:
    branches:
      - main # Change this to your default branch name
  pull_request:
    branches:
      - main # Change this to your default branch name
  workflow_dispatch:

jobs:
  build:
    name: Build
    runs-on: macos-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Xcode
      uses: actions/setup-xcode@v2
      with:
        xcode-version: 13.0 # Adjust the version as needed

    - name: Install CocoaPods
      run: |
        gem install cocoapods
        pod install

    - name: Build the macOS application
      run: xcodebuild -project ScreenTimeLapse.xcodeproj -scheme ScreenTimeLapse -configuration Release -sdk macosx clean build

    - name: Archive the application
      run: xcodebuild -project ScreenTimeLapse.xcodeproj -scheme ScreenTimeLapse -configuration Release -archivePath build/ScreenTimeLapse

    - name: Export the application as a DMG
      run: xcodebuild -exportArchive -archivePath build/ScreenTimeLapse.xcarchive -exportOptionsPlist ExportOptions.plist -exportPath build

    - name: Upload the macOS application
      uses: actions/upload-artifact@v2
      with:
        name: ScreenTimeLapse
        path: ./build/ScreenTimeLapse.dmg
